/**
 * @since 1.0.0
 */
import type * as Cause from "effect/Cause"
import type * as FiberId from "effect/FiberId"
import * as internal from "../internal/http/serverError.js"
import type * as ServerRequest from "./ServerRequest.js"
import type * as ServerResponse from "./ServerResponse.js"

/**
 * @since 1.0.0
 * @category type id
 */
export const TypeId: unique symbol = internal.TypeId

/**
 * @since 1.0.0
 * @category type id
 */
export type TypeId = typeof TypeId

/**
 * @since 1.0.0
 * @category error
 */
export type HttpServerError = RequestError | ResponseError | RouteNotFound | ServeError

/**
 * @since 1.0.0
 */
export declare namespace HttpError {
  /**
   * @since 1.0.0
   * @category models
   */
  export interface Proto {
    readonly [TypeId]: TypeId
    readonly _tag: string
  }

  /**
   * @since 1.0.0
   */
  export type ProvidedFields = TypeId | "_tag"
}

/**
 * @since 1.0.0
 * @category error
 */
export interface RequestError extends HttpError.Proto {
  readonly _tag: "RequestError"
  readonly request: ServerRequest.ServerRequest
  readonly reason: "Transport" | "Decode"
  readonly error: unknown
}

/**
 * @since 1.0.0
 * @category predicates
 */
export const isServerError: (u: unknown) => u is HttpServerError = internal.isServerError

/**
 * @since 1.0.0
 * @category error
 */
export const RequestError: (props: Omit<RequestError, HttpError.ProvidedFields>) => RequestError = internal.requestError

/**
 * @since 1.0.0
 * @category error
 */
export interface RouteNotFound extends HttpError.Proto {
  readonly _tag: "RouteNotFound"
  readonly request: ServerRequest.ServerRequest
}

/**
 * @since 1.0.0
 * @category error
 */
export const RouteNotFound: (props: Omit<RouteNotFound, HttpError.ProvidedFields>) => RouteNotFound =
  internal.routeNotFound

/**
 * @since 1.0.0
 * @category error
 */
export interface ResponseError extends HttpError.Proto {
  readonly _tag: "ResponseError"
  readonly request: ServerRequest.ServerRequest
  readonly response: ServerResponse.ServerResponse
  readonly reason: "Decode"
  readonly error: unknown
}

/**
 * @since 1.0.0
 * @category error
 */
export const ResponseError: (props: Omit<ResponseError, HttpError.ProvidedFields>) => ResponseError =
  internal.responseError

/**
 * @since 1.0.0
 * @category error
 */
export interface ServeError extends HttpError.Proto {
  readonly _tag: "ServeError"
  readonly error: unknown
}

/**
 * @since 1.0.0
 * @category error
 */
export const ServeError: (props: Omit<ServeError, HttpError.ProvidedFields>) => ServeError = internal.serveError

/**
 * @since 1.0.0
 */
export const clientAbortFiberId: FiberId.FiberId = internal.clientAbortFiberId

/**
 * @since 1.0.0
 */
export const isClientAbortCause: <E>(cause: Cause.Cause<E>) => boolean = internal.isClientAbortCause
